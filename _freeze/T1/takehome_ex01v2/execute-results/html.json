{
  "hash": "6cdec0c0ad9ed1985dffec3d85d94807",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take Home Exercise 1\"\nauthor: \"Lau Jia Yi\"\ndate: 3 May 2024\ndate-modified: \"last-modified\"\nformat: html\neditor: visual\nexecute:\n  eval: true\n  echo: true\n  warning: false\n  freeze: true\n---\n\n\n\n# Singapore in 2024: A Visual Guide to our Population Landscape.\n\n## 1.0 Introduction\n\nSingapore’s population structure reveals a dynamic interplay between urban development, ageing, and youth distribution. Let's explore the demographic breakdown of 2024 through interactive charts.\n\n------------------------------------------------------------------------\n\n## 2.0 Loading R Packages and Dataset\n\n### 2.1 Libraries Required\n\nThe following R packages were used via `pacman::p_load()` to support data wrangling, visualization, and mapping for Singapore’s 2024 population data.\n\n| Package | Description | Official Link |\n|------------------------|------------------------|------------------------|\n| **`tidyverse`** | A collection of R packages (including `ggplot2`, `dplyr`, `readr`, etc.) for data manipulation, exploration, and visualization. It forms the foundation of modern R workflows. | [tidyverse.org](https://www.tidyverse.org/) |\n| **`ggthemes`** | Provides additional themes, color palettes, and formatting options for `ggplot2` charts, such as Economist, Wall Street Journal, and Tufte styles. | CRAN – ggthemes |\n| **`gghighlight`** | Simplifies highlighting specific data in `ggplot2` visualizations without manual filtering. Great for emphasizing trends. | [GitHub – gghighlight](https://github.com/yutannihilation/gghighlight) |\n| **`patchwork`** | Enables easy composition of multiple `ggplot2` plots into complex layouts. Very useful for dashboards or comparative plots. | patchwork.data-imaginist.com |\n| **`sf`** | Provides tools for handling and analyzing geospatial vector data using a `data.frame`-like structure. Compatible with the `tidyverse`. | R-Spatial – sf |\n| **`tmap`** | A flexible mapping package for creating static and interactive thematic maps from spatial data, built to work well with `sf`. | r-tmap.github.io |\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse, ggthemes, gghighlight, ggrepel, patchwork,  sf, tmap, knitr, scales, colorspaces, ggh4x, RColorBrewer, ggdist)\n```\n:::\n\n\n\n### 2.1 Loading the dataset\n\nThe dataset used is \"Singapore Residents by Planning Area / Subzone, Single Year of Age and Sex, June 2024\", it is shared by the Department of Statistics, Singapore (DOS).\n\nWe begin by loading the required libraries and reading the dataset using `readr::read_csv()` from the `tidyverse` collection:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- read_csv(\"data/respopagesex2024.csv\")\n```\n:::\n\n\n\nThis dataset provides a snapshot of the resident population in Singapore as of June 2024, broken down by planning areas, subzones, age, and sex.\n\n#### **2.1.1 Column Descriptions**\n\n| Column | Description                                        |\n|--------|----------------------------------------------------|\n| `PA`   | Planning Area – As defined by URA Master Plan 2019 |\n| `SZ`   | Subzone – Subdivision within a planning area       |\n| `Age`  | Single Year of Age – From 0 to 100+                |\n| `Sex`  | Sex – \"Males\" or \"Females\"                         |\n| `Pop`  | Resident Count – Rounded to the nearest 10         |\n| `Time` | Reference Period                                   |\n\n#### 2.1.2 Notes from Source\n\n-   Residents who have been away from Singapore for more than **12 continuous months** are excluded.\n-   All population counts are **rounded to the nearest 10**, which may result in totals that do not sum exactly.\n-   The reference period for this dataset is **June 2024**.\n\n#### 2.1.3 Understanding the data\n\nBefore we proceed with visualisation, a few inspection and validation of the dataset will be performed.\n\n::: panel-tabset\n## Preview of Loaded dataset (Header)\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 6\n  PA         SZ                     Age   Sex       Pop  Time\n  <chr>      <chr>                  <chr> <chr>   <dbl> <dbl>\n1 Ang Mo Kio Ang Mo Kio Town Centre 0     Males      10  2024\n2 Ang Mo Kio Ang Mo Kio Town Centre 0     Females    10  2024\n3 Ang Mo Kio Ang Mo Kio Town Centre 1     Males      10  2024\n4 Ang Mo Kio Ang Mo Kio Town Centre 1     Females    10  2024\n5 Ang Mo Kio Ang Mo Kio Town Centre 2     Males      10  2024\n6 Ang Mo Kio Ang Mo Kio Town Centre 2     Females    10  2024\n```\n\n\n:::\n:::\n\n\n\n## Preview of Loaded dataset (Glimpse)\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 60,424\nColumns: 6\n$ PA   <chr> \"Ang Mo Kio\", \"Ang Mo Kio\", \"Ang Mo Kio\", \"Ang Mo Kio\", \"Ang Mo K…\n$ SZ   <chr> \"Ang Mo Kio Town Centre\", \"Ang Mo Kio Town Centre\", \"Ang Mo Kio T…\n$ Age  <chr> \"0\", \"0\", \"1\", \"1\", \"2\", \"2\", \"3\", \"3\", \"4\", \"4\", \"5\", \"5\", \"6\", …\n$ Sex  <chr> \"Males\", \"Females\", \"Males\", \"Females\", \"Males\", \"Females\", \"Male…\n$ Pop  <dbl> 10, 10, 10, 10, 10, 10, 10, 10, 30, 10, 20, 10, 20, 30, 30, 10, 3…\n$ Time <dbl> 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024,…\n```\n\n\n:::\n:::\n\n\n:::\n\nThere are 60,424 rows noted with the 6 columns as stated in the source notes stated in earlier section 2.1.\n\nHowever the column Age has been loaded as a character type instead of double (numeric) variable as it includes a categorical label for the age group 90+ as \"90_and_Over\". This could be handled by converting this label into \"90\"together with an additional categorical label for this project.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- read_csv(\"data/respopagesex2024.csv\",\n  col_types = cols(\n    Age = col_character()\n  )\n) %>%\n  rename(\n    Planning_Area = PA,\n    Subzone = SZ,\n    Population = Pop\n  ) %>%\n  mutate(\n    Age_Num = if_else(Age == \"90_and_Over\", 90L, as.integer(Age)),\n    AgeGroup = case_when(\n      Age_Num <= 14 ~ \"Children (0–14)\",\n      Age_Num <= 24 ~ \"Youth (15–24)\",\n      Age_Num <= 64 ~ \"Adults (25–64)\",\n      TRUE ~ \"Elderly (65+)\"\n    ),\n    AgeGroup = factor(\n      AgeGroup,\n      levels = c(\"Children (0–14)\", \"Youth (15–24)\", \"Adults (25–64)\", \"Elderly (65+)\")\n    ),\n    Region = case_when(\n      Planning_Area %in% c(\n        \"Ang Mo Kio\", \"Hougang\", \"Punggol\", \"Sengkang\", \"Serangoon\",\n        \"Seletar\", \"North-Eastern Islands\"\n      ) ~ \"North-East\",\n      Planning_Area %in% c(\n        \"Bedok\", \"Pasir Ris\", \"Tampines\", \"Changi\", \"Changi Bay\", \"Paya Lebar\"\n      ) ~ \"East\",\n      Planning_Area %in% c(\n        \"Bishan\", \"Bukit Merah\", \"Bukit Timah\", \"Downtown Core\", \"Geylang\", \"Kallang\",\n        \"Marine Parade\", \"Museum\", \"Newton\", \"Novena\", \"Orchard\", \"Outram\", \"Queenstown\",\n        \"River Valley\", \"Rochor\", \"Singapore River\", \"Southern Islands\", \"Straits View\",\n        \"Tanglin\", \"Toa Payoh\"\n      ) ~ \"Central\",\n      Planning_Area %in% c(\n        \"Boon Lay\", \"Bukit Batok\", \"Bukit Panjang\", \"Choa Chu Kang\", \"Clementi\", \"Jurong East\",\n        \"Jurong West\", \"Pioneer\", \"Tengah\", \"Tuas\", \"Western Islands\", \"Western Water Catchment\"\n      ) ~ \"West\",\n      Planning_Area %in% c(\n        \"Lim Chu Kang\", \"Mandai\", \"Sembawang\", \"Simpang\", \"Sungei Kadut\", \"Woodlands\",\n        \"Yishun\", \"Central Water Catchment\"\n      ) ~ \"North\",\n    )\n  )\n```\n:::\n\n\n\n::: panel-tabset\n## Preview of Updated Dataset (Header)\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 9\n  Planning_Area Subzone     Age   Sex   Population  Time Age_Num AgeGroup Region\n  <chr>         <chr>       <chr> <chr>      <dbl> <dbl>   <int> <fct>    <chr> \n1 Ang Mo Kio    Ang Mo Kio… 0     Males         10  2024       0 Childre… North…\n2 Ang Mo Kio    Ang Mo Kio… 0     Fema…         10  2024       0 Childre… North…\n3 Ang Mo Kio    Ang Mo Kio… 1     Males         10  2024       1 Childre… North…\n4 Ang Mo Kio    Ang Mo Kio… 1     Fema…         10  2024       1 Childre… North…\n5 Ang Mo Kio    Ang Mo Kio… 2     Males         10  2024       2 Childre… North…\n6 Ang Mo Kio    Ang Mo Kio… 2     Fema…         10  2024       2 Childre… North…\n```\n\n\n:::\n:::\n\n\n\n## Preview of Updated Dataset (Glimpse)\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 60,424\nColumns: 9\n$ Planning_Area <chr> \"Ang Mo Kio\", \"Ang Mo Kio\", \"Ang Mo Kio\", \"Ang Mo Kio\", …\n$ Subzone       <chr> \"Ang Mo Kio Town Centre\", \"Ang Mo Kio Town Centre\", \"Ang…\n$ Age           <chr> \"0\", \"0\", \"1\", \"1\", \"2\", \"2\", \"3\", \"3\", \"4\", \"4\", \"5\", \"…\n$ Sex           <chr> \"Males\", \"Females\", \"Males\", \"Females\", \"Males\", \"Female…\n$ Population    <dbl> 10, 10, 10, 10, 10, 10, 10, 10, 30, 10, 20, 10, 20, 30, …\n$ Time          <dbl> 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 20…\n$ Age_Num       <int> 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9,…\n$ AgeGroup      <fct> Children (0–14), Children (0–14), Children (0–14), Child…\n$ Region        <chr> \"North-East\", \"North-East\", \"North-East\", \"North-East\", …\n```\n\n\n:::\n:::\n\n\n:::\n\n## 3.0 Visualisations\n\n### 3.1 Population Pyramid\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Find the maximum age\nmax_age <- max(df$Age_Num, na.rm = TRUE)\n\n# Prepare the data\nplot_df <- df %>%\n  mutate(\n    AgeGroup = cut(\n      Age_Num,\n      breaks = if (max_age > 90) {\n        c(seq(0, 85, by = 5), 90, max_age + 1)\n      } else {\n        c(seq(0, 85, by = 5), max_age + 1)\n      },\n      right = FALSE,\n      labels = if (max_age > 90) {\n        c(paste0(seq(0, 80, by = 5), \"-\", seq(4, 84, by = 5)), \"90+\")\n      } else {\n        c(paste0(seq(0, 80, by = 5), \"-\", seq(4, 84, by = 5)), \"90+\")\n      }\n    )\n  ) %>%\n  group_by(AgeGroup, Sex) %>%\n  summarise(Population = sum(Population), .groups = \"drop\") %>%\n  mutate(\n    Population = ifelse(Sex == \"Males\", -Population, Population),\n    PopulationAbs = abs(Population)\n  )\n\n# Plot\nggplot(plot_df, aes(x = AgeGroup, y = Population, fill = Sex)) +\n  geom_bar(stat = \"identity\", width = 0.90, color = \"black\") +\n  geom_text_repel(\n    aes(label = format(PopulationAbs, big.mark = \",\")),\n    size = 3,\n    direction = \"y\",\n    nudge_y = 15000 * sign(plot_df$Population),\n    hjust = 0.5,\n    segment.color = NA,\n    show.legend = FALSE\n  ) +\n  coord_flip() +\n  labs(\n    title = \"Singapore's Population Pyramid (2024) by 5-Year Age Groups\",\n    x = \"Age Group\",\n    y = \"Population Size\"\n  ) +\n  scale_y_continuous(\n    labels = function(x) format(abs(x), big.mark = \",\", scientific = FALSE),\n    limits = c(-200000, 200000),\n    breaks = seq(-200000, 200000, by = 50000),\n    minor_breaks = seq(-200000, 200000, by = 25000)\n  ) +\n  scale_fill_manual(\n    values = c(\"Males\" = \"#87CEFA\", \"Females\" = \"#FFB6C1\"),\n    breaks = c(\"Males\", \"Females\")\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(hjust = 0.5),\n    legend.position = \"bottom\",\n    axis.text.y = element_text(hjust = 0),\n    panel.grid.minor.x = element_line(color = \"grey85\", size = 0.3)\n  )\n```\n\n::: {.cell-output-display}\n![](takehome_ex01v2_files/figure-html/unnamed-chunk-8-1.png){width=672}\n:::\n:::\n\n\n\n## 3.x Population Density - Overall and by Region\n\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# === STEP 1: OVERALL PLOT ===\n\n# Prepare overall dataset\noverall_df <- df %>%\n  filter(!is.na(Age_Num)) %>%\n  group_by(Region, Age_Num) %>%\n  summarise(Population = sum(Population), .groups = \"drop\") %>%\n  uncount(weights = Population)\n\n# Compute peak by Region\noverall_peaks <- overall_df %>%\n  group_by(Region) %>%\n  summarise(\n    d = list(density(Age_Num)),\n    .groups = \"drop\"\n  ) %>%\n  rowwise() %>%\n  mutate(\n    peak_x = d$x[which.max(d$y)],\n    label = paste0(Region, \": Age \", round(peak_x))\n  ) %>%\n  ungroup()\n\n# Combine labels\noverall_annotation <- paste(overall_peaks$label, collapse = \"\\n\")\n\n# Overall plot\noverall_plot <- ggplot(overall_df, aes(x = Age_Num, fill = Region)) +\n  geom_density(alpha = 0.6, color = \"black\", linewidth = 0.7) +\n  annotate(\"text\", x = 5, y = Inf, vjust = 1.2,\n           label = overall_annotation, hjust = 0, size = 3.5, fontface = \"italic\") +\n  scale_x_continuous(breaks = seq(0, 90, 10)) +\n  scale_fill_brewer(palette = \"Set2\") +\n  labs(\n    title = \"Age Distribution (2024): Overall\",\n    subtitle = \"Density by Region with Y-axis scaled per chart\",\n    x = \"Age\", y = \"Relative Density\", fill = \"Region\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(face = \"bold\", hjust = 0.5),\n    plot.subtitle = element_text(hjust = 0.5),\n    panel.border = element_rect(color = \"grey50\", fill = NA),\n    legend.position = \"right\"\n  )\n\n# === STEP 2: REGION FUNCTION ===\n\ncompute_top3_peaks <- function(region_df) {\n  region_df %>%\n    group_by(Planning_Area) %>%\n    summarise(d = list(density(Age_Num)), .groups = \"drop\") %>%\n    rowwise() %>%\n    mutate(\n      peak_x = d$x[which.max(d$y)],\n      peak_y = max(d$y)\n    ) %>%\n    ungroup() %>%\n    slice_max(order_by = peak_y, n = 3) %>%\n    mutate(label = Planning_Area) %>%\n    select(Planning_Area, peak_x, peak_y, label)\n}\n\nmake_region_plot <- function(region_name, palette_name = \"Set2\") {\n  region_df <- df %>%\n    filter(Region == region_name, !is.na(Age_Num)) %>%\n    group_by(Planning_Area, Age_Num) %>%\n    summarise(Population = sum(Population), .groups = \"drop\") %>%\n    uncount(weights = Population) %>%\n    mutate(Planning_Area = factor(Planning_Area))\n\n  # Colors\n  n_colors <- length(levels(region_df$Planning_Area))\n  base_colors <- if (n_colors <= 8) {\n    brewer.pal(8, palette_name)[1:n_colors]\n  } else {\n    colorRampPalette(brewer.pal(8, palette_name))(n_colors)\n  }\n  names(base_colors) <- levels(region_df$Planning_Area)\n\n  # Top 3 peak labels\n  peak_labels <- compute_top3_peaks(region_df)\n\n  ggplot(region_df, aes(x = Age_Num, fill = Planning_Area, color = Planning_Area)) +\n    geom_density(alpha = 0.5, linewidth = 0.7) +\n    ggrepel::geom_label_repel(\n      data = peak_labels,\n      aes(x = peak_x, y = peak_y, label = label, fill = Planning_Area),\n      color = \"black\", size = 3,\n      box.padding = 0.3, segment.color = \"grey50\", show.legend = FALSE\n    ) +\n    scale_fill_manual(values = base_colors, guide = guide_legend(override.aes = list(alpha = 1))) +\n    scale_color_manual(values = base_colors, guide = \"none\") +\n    scale_x_continuous(breaks = seq(0, 90, 10)) +\n    labs(\n      title = paste(\"Age Distribution –\", region_name),\n      x = \"Age\", y = \"Relative Density\", fill = \"Planning Area\"\n    ) +\n    theme_minimal() +\n    theme(\n      plot.title = element_text(face = \"bold\", hjust = 0.5),\n      panel.border = element_rect(color = \"grey50\", fill = NA),\n      legend.position = \"right\"\n    )\n}\n\n# === STEP 3: Region Plots ===\n\ncentral_plot     <- make_region_plot(\"Central\", \"Set2\")\neast_plot        <- make_region_plot(\"East\", \"Pastel1\")\nnorth_plot       <- make_region_plot(\"North\", \"Accent\")\nnorth_east_plot  <- make_region_plot(\"North-East\", \"Dark2\")\nwest_plot        <- make_region_plot(\"West\", \"Set3\")\n\n# === STEP 4: Assemble Layout ===\n\nfinal_plot <- \n  overall_plot /\n  (central_plot | east_plot) /\n  (north_plot | north_east_plot) /\n  (west_plot + patchwork::plot_spacer()) +\n  plot_layout(heights = c(1, 1, 1, 1)) +\n  plot_annotation(\n    title = \"Age Distribution (2024): Overall and by Region\",\n    subtitle = \"Top: Overall with regional overlay | Below: Each region shows its planning areas (Top 3 labelled)\\nY-axis scales independently per chart\",\n    theme = theme(\n      plot.title = element_text(size = 16, face = \"bold\", hjust = 0.5),\n      plot.subtitle = element_text(size = 11, hjust = 0.5)\n    )\n  )\n\n# === STEP 5: Render ===\nfinal_plot\n```\n\n::: {.cell-output-display}\n![](takehome_ex01v2_files/figure-html/unnamed-chunk-9-1.png){width=1536}\n:::\n:::\n\n\n\n\n## 3.3\n\n",
    "supporting": [
      "takehome_ex01v2_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}