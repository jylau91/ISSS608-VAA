{
  "hash": "dd29e121f9f64e406637cfca1fdb7ac3",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Take Home Exercise 1\"\nauthor: \"Lau Jia Yi\"\ndate: 3 May 2024\ndate-modified: \"last-modified\"\nformat: html\neditor: visual\nexecute:\n  eval: true\n  echo: true\n  warning: false\n  freeze: true\n---\n\n\n\n# Singapore in 2024: A Visual Guide to our Population Landscape.\n\n## 1.0 Introduction\n\nSingapore’s population structure reveals a dynamic interplay between urban development, ageing, and youth distribution. Let's explore the demographic breakdown of 2024 through interactive charts.\n\n------------------------------------------------------------------------\n\n## 2.0 Loading R Packages and Dataset\n\n### 2.1 Libraries Required\n\nThe following R packages were used via `pacman::p_load()` to support data wrangling, visualization, and mapping for Singapore’s 2024 population data.\n\n| Package | Description | Official Link |\n|------------------------|------------------------|------------------------|\n| **`tidyverse`** | A collection of R packages (including `ggplot2`, `dplyr`, `readr`, etc.) for data manipulation, exploration, and visualization. It forms the foundation of modern R workflows. | [tidyverse.org](https://www.tidyverse.org/) |\n| **`ggthemes`** | Provides additional themes, color palettes, and formatting options for `ggplot2` charts, such as Economist, Wall Street Journal, and Tufte styles. | CRAN – ggthemes |\n| **`gghighlight`** | Simplifies highlighting specific data in `ggplot2` visualizations without manual filtering. Great for emphasizing trends. | [GitHub – gghighlight](https://github.com/yutannihilation/gghighlight) |\n| **`patchwork`** | Enables easy composition of multiple `ggplot2` plots into complex layouts. Very useful for dashboards or comparative plots. | patchwork.data-imaginist.com |\n| **`sf`** | Provides tools for handling and analyzing geospatial vector data using a `data.frame`-like structure. Compatible with the `tidyverse`. | R-Spatial – sf |\n| **`tmap`** | A flexible mapping package for creating static and interactive thematic maps from spatial data, built to work well with `sf`. | r-tmap.github.io |\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npacman::p_load(tidyverse, ggthemes, gghighlight, ggrepel, patchwork,  sf, tmap, knitr, scales)\n```\n:::\n\n\n\n### 2.1 Loading the dataset\n\nThe dataset used is \"Singapore Residents by Planning Area / Subzone, Single Year of Age and Sex, June 2024\", it is shared by the Department of Statistics, Singapore (DOS).\n\nWe begin by loading the required libraries and reading the dataset using `readr::read_csv()` from the `tidyverse` collection:\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- read_csv(\"data/respopagesex2024.csv\")\n```\n:::\n\n\n\nThis dataset provides a snapshot of the resident population in Singapore as of June 2024, broken down by planning areas, subzones, age, and sex.\n\n#### **2.1.1 Column Descriptions**\n\n| Column | Description                                        |\n|--------|----------------------------------------------------|\n| `PA`   | Planning Area – As defined by URA Master Plan 2019 |\n| `SZ`   | Subzone – Subdivision within a planning area       |\n| `Age`  | Single Year of Age – From 0 to 100+                |\n| `Sex`  | Sex – \"Males\" or \"Females\"                         |\n| `Pop`  | Resident Count – Rounded to the nearest 10         |\n| `Time` | Reference Period                                   |\n\n#### 2.1.2 Notes from Source\n\n-   Residents who have been away from Singapore for more than **12 continuous months** are excluded.\n-   All population counts are **rounded to the nearest 10**, which may result in totals that do not sum exactly.\n-   The reference period for this dataset is **June 2024**.\n\n#### 2.1.3 Understanding the data\n\nBefore we proceed with visualisation, a few inspection and validation of the dataset will be performed.\n\n::: panel-tabset\n## Preview of Loaded dataset (Header)\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 6\n  PA         SZ                     Age   Sex       Pop  Time\n  <chr>      <chr>                  <chr> <chr>   <dbl> <dbl>\n1 Ang Mo Kio Ang Mo Kio Town Centre 0     Males      10  2024\n2 Ang Mo Kio Ang Mo Kio Town Centre 0     Females    10  2024\n3 Ang Mo Kio Ang Mo Kio Town Centre 1     Males      10  2024\n4 Ang Mo Kio Ang Mo Kio Town Centre 1     Females    10  2024\n5 Ang Mo Kio Ang Mo Kio Town Centre 2     Males      10  2024\n6 Ang Mo Kio Ang Mo Kio Town Centre 2     Females    10  2024\n```\n\n\n:::\n:::\n\n\n\n## Preview of Loaded dataset (Glimpse)\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 60,424\nColumns: 6\n$ PA   <chr> \"Ang Mo Kio\", \"Ang Mo Kio\", \"Ang Mo Kio\", \"Ang Mo Kio\", \"Ang Mo K…\n$ SZ   <chr> \"Ang Mo Kio Town Centre\", \"Ang Mo Kio Town Centre\", \"Ang Mo Kio T…\n$ Age  <chr> \"0\", \"0\", \"1\", \"1\", \"2\", \"2\", \"3\", \"3\", \"4\", \"4\", \"5\", \"5\", \"6\", …\n$ Sex  <chr> \"Males\", \"Females\", \"Males\", \"Females\", \"Males\", \"Females\", \"Male…\n$ Pop  <dbl> 10, 10, 10, 10, 10, 10, 10, 10, 30, 10, 20, 10, 20, 30, 30, 10, 3…\n$ Time <dbl> 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024,…\n```\n\n\n:::\n:::\n\n\n:::\n\nThere are 60,424 rows noted with the 6 columns as stated in the source notes stated in earlier section 2.1.\n\nHowever the column Age has been loaded as a character type instead of double (numeric) variable as it includes a categorical label for the age group 90+ as \"90_and_Over\". This could be handled by converting this label into \"90\"together with an additional categorical label for this project.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ndf <- read_csv(\"data/respopagesex2024.csv\",\n  col_types = cols(\n    Age = col_character(),\n  )\n) %>%\n  rename(\n    Planning_Area = PA,\n    Subzone = SZ,\n    Population = Pop\n  ) %>%\n  mutate(\n    Age_Num = if_else(Age == \"90_and_Over\", 90L, as.integer(Age)),\n    AgeGroup = case_when(\n      Age_Num <= 14 ~ \"Children (0–14)\",\n      Age_Num <= 24 ~ \"Youth (15–24)\",\n      Age_Num <= 64 ~ \"Adults (25–64)\",\n      TRUE ~ \"Elderly (65+)\"\n    ),\n    AgeGroup = factor(\n      AgeGroup,\n      levels = c(\"Children (0–14)\", \"Youth (15–24)\", \"Adults (25–64)\", \"Elderly (65+)\")\n    )\n  )\n```\n:::\n\n\n\n::: panel-tabset\n## Preview of Updated Dataset (Header)\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\n# A tibble: 6 × 8\n  Planning_Area Subzone            Age   Sex   Population  Time Age_Num AgeGroup\n  <chr>         <chr>              <chr> <chr>      <dbl> <dbl>   <int> <fct>   \n1 Ang Mo Kio    Ang Mo Kio Town C… 0     Males         10  2024       0 Childre…\n2 Ang Mo Kio    Ang Mo Kio Town C… 0     Fema…         10  2024       0 Childre…\n3 Ang Mo Kio    Ang Mo Kio Town C… 1     Males         10  2024       1 Childre…\n4 Ang Mo Kio    Ang Mo Kio Town C… 1     Fema…         10  2024       1 Childre…\n5 Ang Mo Kio    Ang Mo Kio Town C… 2     Males         10  2024       2 Childre…\n6 Ang Mo Kio    Ang Mo Kio Town C… 2     Fema…         10  2024       2 Childre…\n```\n\n\n:::\n:::\n\n\n\n## Preview of Updated Dataset (Glimpse)\n\n\n\n::: {.cell}\n::: {.cell-output .cell-output-stdout}\n\n```\nRows: 60,424\nColumns: 8\n$ Planning_Area <chr> \"Ang Mo Kio\", \"Ang Mo Kio\", \"Ang Mo Kio\", \"Ang Mo Kio\", …\n$ Subzone       <chr> \"Ang Mo Kio Town Centre\", \"Ang Mo Kio Town Centre\", \"Ang…\n$ Age           <chr> \"0\", \"0\", \"1\", \"1\", \"2\", \"2\", \"3\", \"3\", \"4\", \"4\", \"5\", \"…\n$ Sex           <chr> \"Males\", \"Females\", \"Males\", \"Females\", \"Males\", \"Female…\n$ Population    <dbl> 10, 10, 10, 10, 10, 10, 10, 10, 30, 10, 20, 10, 20, 30, …\n$ Time          <dbl> 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 2024, 20…\n$ Age_Num       <int> 0, 0, 1, 1, 2, 2, 3, 3, 4, 4, 5, 5, 6, 6, 7, 7, 8, 8, 9,…\n$ AgeGroup      <fct> Children (0–14), Children (0–14), Children (0–14), Child…\n```\n\n\n:::\n:::\n\n\n:::\n\nNow that the age variable has been cleaned up, we will proceed with the visualisations to describe the Singapore Population Landscape.\n\n## 3.0 Visualising the Singapore Population Landscape\n\nThis article would focus on the top n% of Singapore\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npopulation_summary <- df %>%\n  group_by(Planning_Area) %>%\n  summarise(\n    Population = sum(Population),\n    .groups = \"drop\"\n  ) %>%\n  mutate(\n    Percent = round(Population / sum(Population) * 100, 2)\n  ) %>%\n  arrange(desc(Population)) %>%\n  mutate(\n    CumulativePercent = round(cumsum(Percent), 2),\n    `S/N` = row_number()\n  ) %>%\n  select(`S/N`, Planning_Area, Population, Percent, CumulativePercent)\n\nkable(population_summary, \n      caption = \"Population and Cumulative Percentage by Planning Area\")\n```\n\n::: {.cell-output-display}\n\n\nTable: Population and Cumulative Percentage by Planning Area\n\n| S/N|Planning_Area           | Population| Percent| CumulativePercent|\n|---:|:-----------------------|----------:|-------:|-----------------:|\n|   1|Tampines                |     284950|    6.79|              6.79|\n|   2|Bedok                   |     277660|    6.62|             13.41|\n|   3|Sengkang                |     265550|    6.33|             19.74|\n|   4|Jurong West             |     257910|    6.15|             25.89|\n|   5|Woodlands               |     255510|    6.09|             31.98|\n|   6|Yishun                  |     230320|    5.49|             37.47|\n|   7|Hougang                 |     228780|    5.46|             42.93|\n|   8|Punggol                 |     199880|    4.77|             47.70|\n|   9|Choa Chu Kang           |     190640|    4.55|             52.25|\n|  10|Bukit Batok             |     168390|    4.02|             56.27|\n|  11|Ang Mo Kio              |     160450|    3.83|             60.10|\n|  12|Bukit Merah             |     149390|    3.56|             63.66|\n|  13|Pasir Ris               |     145480|    3.47|             67.13|\n|  14|Toa Payoh               |     140030|    3.34|             70.47|\n|  15|Bukit Panjang           |     138730|    3.31|             73.78|\n|  16|Serangoon               |     118250|    2.82|             76.60|\n|  17|Geylang                 |     116820|    2.79|             79.39|\n|  18|Sembawang               |     110670|    2.64|             82.03|\n|  19|Clementi                |     102960|    2.46|             84.49|\n|  20|Queenstown              |     102040|    2.43|             86.92|\n|  21|Kallang                 |     101190|    2.41|             89.33|\n|  22|Bishan                  |      88210|    2.10|             91.43|\n|  23|Bukit Timah             |      84250|    2.01|             93.44|\n|  24|Jurong East             |      74590|    1.78|             95.22|\n|  25|Novena                  |      52150|    1.24|             96.46|\n|  26|Marine Parade           |      46950|    1.12|             97.58|\n|  27|Tanglin                 |      24540|    0.59|             98.17|\n|  28|Outram                  |      16740|    0.40|             98.57|\n|  29|Rochor                  |      13040|    0.31|             98.88|\n|  30|River Valley            |      11970|    0.29|             99.17|\n|  31|Newton                  |       9910|    0.24|             99.41|\n|  32|Tengah                  |       7940|    0.19|             99.60|\n|  33|Singapore River         |       4200|    0.10|             99.70|\n|  34|Downtown Core           |       4170|    0.10|             99.80|\n|  35|Southern Islands        |       2580|    0.06|             99.86|\n|  36|Mandai                  |       2130|    0.05|             99.91|\n|  37|Changi                  |       1830|    0.04|             99.95|\n|  38|Orchard                 |        870|    0.02|             99.97|\n|  39|Sungei Kadut            |        600|    0.01|             99.98|\n|  40|Western Water Catchment |        590|    0.01|             99.99|\n|  41|Museum                  |        530|    0.01|            100.00|\n|  42|Seletar                 |        140|    0.00|            100.00|\n|  43|Boon Lay                |          0|    0.00|            100.00|\n|  44|Central Water Catchment |          0|    0.00|            100.00|\n|  45|Changi Bay              |          0|    0.00|            100.00|\n|  46|Lim Chu Kang            |          0|    0.00|            100.00|\n|  47|Marina East             |          0|    0.00|            100.00|\n|  48|Marina South            |          0|    0.00|            100.00|\n|  49|North-Eastern Islands   |          0|    0.00|            100.00|\n|  50|Paya Lebar              |          0|    0.00|            100.00|\n|  51|Pioneer                 |          0|    0.00|            100.00|\n|  52|Simpang                 |          0|    0.00|            100.00|\n|  53|Straits View            |          0|    0.00|            100.00|\n|  54|Tuas                    |          0|    0.00|            100.00|\n|  55|Western Islands         |          0|    0.00|            100.00|\n\n\n:::\n:::\n\n\n\n### 3.1 Overview of the Population Distribution\n\nTop 30 Planning Areas by Age Group Distribution\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\ntop_n <- 30\n\ntop_areas <- df %>%\n  group_by(Planning_Area) %>%\n  summarise(Total = sum(Population), .groups = \"drop\") %>%\n  slice_max(Total, n = top_n) %>%\n  pull(Planning_Area)\n\ndf %>%\n  filter(Planning_Area %in% top_areas) %>%\n  group_by(Planning_Area, AgeGroup) %>%\n  summarise(Population = sum(Population), .groups = \"drop\") %>%\n  ggplot(aes(x = reorder(Planning_Area, -Population), y = Population, fill = AgeGroup)) +\n  geom_col() +\n  scale_y_continuous(labels = scales::label_comma()) +\n  labs(title = paste(\"Top\", top_n, \"Planning Areas by Age Group Distribution\"),\n       x = \"Planning Area\", y = \"Population\") +\n  theme_minimal() +\n  theme(\n    axis.text.x = element_text(angle = 45, hjust = 1, size = 9),\n    plot.title = element_text(size = 14, face = \"bold\")\n  )\n```\n\n::: {.cell-output-display}\n![](takehome_ex01_files/figure-html/unnamed-chunk-9-1.png){width=1536}\n:::\n:::\n\n\n\nLoading the Master Plan 2014 Planning Area Boundary [shapefile obtained from data.gov.sg](https://data.gov.sg/datasets?query=planning+area&page=1&formats=SHP&resultId=d_6d6fd6505f23d7fb90dec567afd555bb).\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nplanning_sf <- st_read(\"data/MP14/MP14_PLNG_AREA_WEB_PL.shp\")\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nReading layer `MP14_PLNG_AREA_WEB_PL' from data source \n  `C:\\Users\\jia_y\\OneDrive - Singapore Management University\\Semester 6\\ISSS608 VAA\\jylau91\\ISSS608-VAA\\T1\\data\\MP14\\MP14_PLNG_AREA_WEB_PL.shp' \n  using driver `ESRI Shapefile'\nSimple feature collection with 55 features and 12 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 2667.538 ymin: 15748.72 xmax: 56396.44 ymax: 50256.33\nProjected CRS: SVY21\n```\n\n\n:::\n:::\n\n\n\nSummarise population by Planning Area variabe\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\npop_summary <- df %>%\n  group_by(Planning_Area) %>%\n  summarise(Population = sum(Population), .groups = \"drop\")\n```\n:::\n\n\n\nJoin population data with shapefile, converting planning area in the population dataset to upper case to match the shapefile's planning area naming convention\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nunique(planning_sf$PLN_AREA_N)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"BISHAN\"                  \"BUKIT BATOK\"            \n [3] \"BUKIT MERAH\"             \"BUKIT PANJANG\"          \n [5] \"BUKIT TIMAH\"             \"CENTRAL WATER CATCHMENT\"\n [7] \"CHANGI\"                  \"CHANGI BAY\"             \n [9] \"CHOA CHU KANG\"           \"CLEMENTI\"               \n[11] \"GEYLANG\"                 \"NOVENA\"                 \n[13] \"PASIR RIS\"               \"PAYA LEBAR\"             \n[15] \"SELETAR\"                 \"SEMBAWANG\"              \n[17] \"BEDOK\"                   \"BOON LAY\"               \n[19] \"SENGKANG\"                \"SERANGOON\"              \n[21] \"ANG MO KIO\"              \"TENGAH\"                 \n[23] \"TOA PAYOH\"               \"WESTERN WATER CATCHMENT\"\n[25] \"YISHUN\"                  \"DOWNTOWN CORE\"          \n[27] \"MARINA EAST\"             \"NEWTON\"                 \n[29] \"ORCHARD\"                 \"WOODLANDS\"              \n[31] \"MARINA SOUTH\"            \"MUSEUM\"                 \n[33] \"HOUGANG\"                 \"JURONG EAST\"            \n[35] \"LIM CHU KANG\"            \"MANDAI\"                 \n[37] \"MARINE PARADE\"           \"NORTH-EASTERN ISLANDS\"  \n[39] \"PIONEER\"                 \"PUNGGOL\"                \n[41] \"QUEENSTOWN\"              \"SOUTHERN ISLANDS\"       \n[43] \"TUAS\"                    \"JURONG WEST\"            \n[45] \"KALLANG\"                 \"SIMPANG\"                \n[47] \"SUNGEI KADUT\"            \"TAMPINES\"               \n[49] \"WESTERN ISLANDS\"         \"TANGLIN\"                \n[51] \"OUTRAM\"                  \"RIVER VALLEY\"           \n[53] \"ROCHOR\"                  \"SINGAPORE RIVER\"        \n[55] \"STRAITS VIEW\"           \n```\n\n\n:::\n\n```{.r .cell-code}\nunique(df$Planning_Area)\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\n [1] \"Ang Mo Kio\"              \"Bedok\"                  \n [3] \"Bishan\"                  \"Boon Lay\"               \n [5] \"Bukit Batok\"             \"Bukit Merah\"            \n [7] \"Bukit Panjang\"           \"Bukit Timah\"            \n [9] \"Central Water Catchment\" \"Changi\"                 \n[11] \"Changi Bay\"              \"Choa Chu Kang\"          \n[13] \"Clementi\"                \"Downtown Core\"          \n[15] \"Geylang\"                 \"Hougang\"                \n[17] \"Jurong East\"             \"Jurong West\"            \n[19] \"Kallang\"                 \"Lim Chu Kang\"           \n[21] \"Mandai\"                  \"Marina East\"            \n[23] \"Marina South\"            \"Marine Parade\"          \n[25] \"Museum\"                  \"Newton\"                 \n[27] \"North-Eastern Islands\"   \"Novena\"                 \n[29] \"Orchard\"                 \"Outram\"                 \n[31] \"Pasir Ris\"               \"Paya Lebar\"             \n[33] \"Pioneer\"                 \"Punggol\"                \n[35] \"Queenstown\"              \"River Valley\"           \n[37] \"Rochor\"                  \"Seletar\"                \n[39] \"Sembawang\"               \"Sengkang\"               \n[41] \"Serangoon\"               \"Simpang\"                \n[43] \"Singapore River\"         \"Southern Islands\"       \n[45] \"Straits View\"            \"Sungei Kadut\"           \n[47] \"Tampines\"                \"Tanglin\"                \n[49] \"Tengah\"                  \"Toa Payoh\"              \n[51] \"Tuas\"                    \"Western Islands\"        \n[53] \"Western Water Catchment\" \"Woodlands\"              \n[55] \"Yishun\"                 \n```\n\n\n:::\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplanning_sf <- planning_sf %>%\n  mutate(Area_km2 = as.numeric(st_area(geometry)) / 1e6)  # from m² to km²\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nplanning_map <- planning_sf %>%\n  mutate(PLN_AREA_N = toupper(PLN_AREA_N)) %>%\n  left_join(\n    pop_summary %>% mutate(Planning_Area = toupper(Planning_Area)),\n    by = c(\"PLN_AREA_N\" = \"Planning_Area\")\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\npop_by_area_age <- df %>%\n  group_by(Planning_Area, AgeGroup) %>%\n  summarise(Population = sum(Population), .groups = \"drop\") %>%\n  mutate(Planning_Area = toupper(Planning_Area))  # Match shapefile casing\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmap_data <- planning_sf %>%\n  select(PLN_AREA_N, geometry, Area_km2) %>%\n  right_join(pop_by_area_age, by = c(\"PLN_AREA_N\" = \"Planning_Area\")) %>%\n  mutate(\n    PopDensity = Population / Area_km2\n  )\n```\n:::\n\n\n\nMaximum population density by planning area is Choa Chu Kang at 18,349 / kmsq.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmax_density_area <- map_data %>%\n  filter(PopDensity == max(PopDensity, na.rm = TRUE)) %>%\n  select(PLN_AREA_N, PopDensity) %>%\n  distinct()\n\nmax_density_area\n```\n\n::: {.cell-output .cell-output-stdout}\n\n```\nSimple feature collection with 1 feature and 2 fields\nGeometry type: MULTIPOLYGON\nDimension:     XY\nBounding box:  xmin: 16798.7 ymin: 39008.54 xmax: 19978.59 ymax: 43037.41\nProjected CRS: SVY21\n     PLN_AREA_N PopDensity                       geometry\n1 CHOA CHU KANG   18746.85 MULTIPOLYGON (((18349.06 43...\n```\n\n\n:::\n:::\n\n\n\nFor proper scaling, we are limitting the population density at 20,000.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmap_data <- map_data %>%\n  mutate(PopDensity_Capped = pmin(PopDensity, 20000))\n```\n:::\n\n\n\nPop density and average age calculation\n\nCalculate average age by Planning Area\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\navg_age <- df %>%\n  group_by(Planning_Area) %>%\n  summarise(Avg_Age = weighted.mean(Age_Num, w = Population), .groups = \"drop\") %>%\n  mutate(Planning_Area = toupper(Planning_Area))\n```\n:::\n\n\n\nJoin with map data and create scaled metric\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\nmap_data <- map_data %>%\n  left_join(avg_age, by = c(\"PLN_AREA_N\" = \"Planning_Area\")) %>%\n  mutate(\n    # Scale both to 0–1\n    PopDensity_Scaled = PopDensity_Capped / max(PopDensity_Capped, na.rm = TRUE),\n    Avg_Age_Scaled = Avg_Age / max(Avg_Age, na.rm = TRUE),\n    \n    # Composite score: equal weight to both\n    DensityAgeIndex = (PopDensity_Scaled + Avg_Age_Scaled) / 2\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\nmap_index <- map_data %>%\n  group_by(PLN_AREA_N) %>%\n  summarise(\n    DensityAgeIndex = mean(DensityAgeIndex, na.rm = TRUE),\n    geometry = st_union(geometry)\n  )\n```\n:::\n\n::: {.cell}\n\n```{.r .cell-code}\n# Get centroids and extract coordinates\ntop5_labels <- map_index %>%\n  slice_max(DensityAgeIndex, n = 5) %>%\n  mutate(centroid = st_centroid(geometry)) %>%\n  mutate(\n    lon = st_coordinates(centroid)[, 1],\n    lat = st_coordinates(centroid)[, 2]\n  )\n\n# Plot with improved label layout\nggplot(map_index) +\n  geom_sf(aes(fill = DensityAgeIndex), color = \"black\", size = 0.2) +\n  geom_label_repel(\n    data = top5_labels,\n    aes(\n      x = lon,\n      y = lat,\n      label = paste0(PLN_AREA_N, \"\\n\", scales::percent(DensityAgeIndex, accuracy = 1))\n    ),\n    size = 3,\n    fontface = \"bold\",\n    nudge_x = 2000,  # nudging right\n    nudge_y = 2000,  # nudging up\n    hjust = 0,       # align left\n    vjust = 1,       # align top\n    box.padding = 0.6,\n    point.padding = 0.5,\n    segment.color = \"black\",\n    segment.size = 0.3,\n    min.segment.length = 0\n  ) +\n  scale_fill_gradientn(\n    colours = c(\"#4575b4\", \"#ffffbf\", \"#d73027\"),\n    limits = c(0, 1),\n    breaks = seq(0, 1, by = 0.1),\n    labels = scales::label_percent(accuracy = 1)\n  ) +\n  labs(\n    title = \"Composite Density-Age Index by Planning Area (2024)\",\n    fill = \"Density-Age Index\"\n  ) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(size = 16, face = \"bold\"),\n    legend.title = element_text(size = 10),\n    legend.text = element_text(size = 8)\n  )\n```\n\n::: {.cell-output-display}\n![](takehome_ex01_files/figure-html/unnamed-chunk-22-1.png){width=1344}\n:::\n:::\n\n\n\nDocument: - top 5, back by facts - possible policy / implications / healthcare / accessibility - note areas in grey - why 0 etc.\n\n### Building pyramid demographic\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Find the maximum age\nmax_age <- max(df$Age_Num)\n\n# Prepare the data for ggplot2\nplot_df <- df %>%\n  # Group ages by 5-year intervals\n  mutate(AgeGroup = cut(Age_Num,\n                       breaks = if(max_age > 90) {c(seq(0, 85, by = 5), 90, max_age + 1)}  # added 1 to max age\n                                  else {c(seq(0, 85, by = 5), max_age + 1)},\n                       right = FALSE,\n                       labels = if(max_age > 90) {c(paste0(seq(0, 80, by = 5), \"-\", seq(4, 84, by = 5)), \"Beyond 90\")}\n                                  else {c(paste0(seq(0, 80, by = 5), \"-\", seq(4, 84, by = 5)), \"Beyond 90\")})) %>%\n  group_by(AgeGroup, Sex) %>%\n  summarise(Population = sum(Population)) %>%\n  ungroup() %>%\n  mutate(Population = ifelse(Sex == \"Males\", -Population, Population)) %>%\n  mutate(PopulationAbs = abs(Population))  # Create absolute value for labels\n\n# Create the population pyramid using ggplot2\nggplot(plot_df, aes(x = AgeGroup, y = Population, fill = Sex)) +\n  geom_bar(stat = \"identity\", width = 0.95, color = \"black\") +\n  coord_flip() +\n  labs(\n    title = \"Population Pyramid for Singapore (2024) by 5-Year Age Groups\",\n    x = \"Age Group\",\n    y = \"Population Size\"\n  ) +\n  scale_y_continuous(labels = function(x) format(abs(x), big.mark = \",\", scientific = FALSE)) +\n  scale_fill_manual(values = c(\"Females\" = \"#FFB6C1\", \"Males\" = \"#87CEFA\")) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(hjust = 0.5),\n    legend.position = \"bottom\",\n    axis.text.y = element_text(hjust = 0)\n  )\n```\n\n::: {.cell-output-display}\n![](takehome_ex01_files/figure-html/unnamed-chunk-23-1.png){width=768}\n:::\n:::\n\n\n### 3.4 Singapore's Population Structure: A Detailed Look\n\nFinally, we examine Singapore's overall population structure using a population pyramid.\n\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Find the maximum age\nmax_age <- max(df$Age_Num)\n\n# Prepare the data for ggplot2\nplot_df <- df %>%\n  # Group ages by 5-year intervals\n  mutate(AgeGroup = cut(Age_Num,\n                       breaks = if (max_age > 90) {\n                         c(seq(0, 85, by = 5), 90, max_age + 1)\n                       } else {\n                         c(seq(0, 85, by = 5), max_age + 1)\n                       },\n                       right = FALSE,\n                       labels = if (max_age > 90) {\n                         c(\n                           paste0(seq(0, 80, by = 5), \"-\", seq(4, 84, by = 5)),\n                           \"Beyond 90\"\n                         )\n                       } else {\n                         c(\n                           paste0(seq(0, 80, by = 5), \"-\", seq(4, 84, by = 5)),\n                           \"Beyond 90\"\n                         )\n                       })) %>%\n  group_by(AgeGroup, Sex) %>%\n  summarise(Population = sum(Population)) %>%\n  ungroup() %>%\n  mutate(Population = ifelse(Sex == \"Males\", -Population, Population)) %>%\n  mutate(PopulationAbs = abs(Population)) # Create absolute value for labels\n\n# Create the population pyramid using ggplot2\nggplot(plot_df, aes(x = AgeGroup, y = Population, fill = Sex)) +\n  geom_bar(stat = \"identity\", width = 0.8, color = \"black\") +\n  coord_flip() +\n  labs(\n    title = \"Singapore's Population Pyramid (2024) by 5-Year Age Groups\",\n    x = \"Age Group\",\n    y = \"Population Size\"\n  ) +\n  scale_y_continuous(labels = function(x)\n    format(abs(x), big.mark = \",\", scientific = FALSE)) +\n  scale_fill_manual(values = c(\"Females\" = \"#FFB6C1\", \"Males\" = \"#87CEFA\")) +\n  theme_minimal() +\n  theme(\n    plot.title = element_text(hjust = 0.5),\n    legend.position = \"bottom\",\n    axis.text.y = element_text(hjust = 0)\n  )\n```\n\n::: {.cell-output-display}\n![](takehome_ex01_files/figure-html/unnamed-chunk-24-1.png){width=768}\n:::\n:::",
    "supporting": [
      "takehome_ex01_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {},
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}